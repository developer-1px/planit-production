import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{o as ut}from"../chunks/Bdc5JO82.js";import{_ as lt,g as s,E as F,a0 as ht,f as A,a3 as f,Y as Q,a as d,a5 as U,a6 as j,m as z,a1 as b,a2 as E,a4 as R,j as B,$ as V}from"../chunks/BukKJz2t.js";import{e as H,s as k}from"../chunks/CF-MGArY.js";import{e as Y,i as K,s as pt,a as X}from"../chunks/Bifmr8Il.js";import{i as ft}from"../chunks/D-PujDQd.js";import{A as dt,U as S}from"../chunks/Dzh9EFqM.js";const vt=(n,e)=>new Promise(function(r){setTimeout(function(){r(n())},e)});var mt=150;function D(n,e){var r="",t="same-origin",a="same-origin";return n=r+n,e.mode=t,e.credentials=a,fetch(n,e)}function gt(n){console.log("fileUpload",n);var e=n.src;return Promise.resolve(_t(e)).then(function(r){return r.type.indexOf("image")===-1?r:new Promise(function(t,a){var i=document.createElement("img");i.onload=function(){r.width=i.naturalWidth||i.width,r.height=i.naturalHeight||i.height,t(r)},i.onerror=function(){a()},i.src=e})}).then(function(r){return nt("/api/files/upload-url").then(function(t){return t.upload_url}).then(function(t){var a=new FormData;return a.append("file",r),a.append("name",n.name),a.append("type",r.type),a.append("size",r.size),a.append("width",r.width),a.append("height",r.height),D(t,{method:"POST",body:a})}).then(function(t){return t.json()})})}function _t(n){var e;n.split(",")[0].indexOf("base64")>=0?e=atob(n.split(",")[1]):e=unescape(n.split(",")[1]);for(var r=n.split(",")[0].split(":")[1].split(";")[0],t=new Uint8Array(e.length),a=0;a<e.length;a++)t[a]=e.charCodeAt(a);return new Blob([t],{type:r})}function $t(n){return n?n.slice(0,5)==="data:":!1}function yt(n){return console.log(n),Object(n)===n&&$t(n.src)}function C(n){for(var e=[],r={},t=0,a=n.length;t<a;t++){var i=n[t],m=typeof i;switch(m){case"number":case"string":e.push(i);break;case"object":r=i;break}}return{path:e.join("/"),data:r}}function Tt(n){return n.json().then(function(e){if(n.ok)return e;throw e&&e.reason&&console.error(e.reason),e})}function q(n){return n.json().then(function(e){if(n.ok)return e;throw e&&e.reason&&(console.error(e.reason),alert(e.reason)),e})}function v(n){return function(e){return n=Math.max(0,mt-(new Date-n)),vt(function(){return typeof globalThis.hideLoading=="function"&&globalThis.hideLoading(),e},n)}}function G(n,e){return e=e||[],foreach(n,function(r,t){if(Array.isArray(r)){G(r,e);return}if(yt(r)){delete n[t],e.push(gt(r).then(function(a){n[t]=a}));return}if(Object(r)===r){G(r,e);return}}),e}function Z(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=C(arguments),e=Object.assign({},n.data);e=JSON.stringify(e),e!=="{}"&&(n.path+="?json="+encodeURIComponent(e));var r=new Date,t=D(n.path,{method:"GET"}).then(Tt);return t.then(v(r),v(r)),t}function nt(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=C(arguments),e=Object.assign({},n.data),r=G(e),t=new Date,a=Promise.all(r).then(function(){return D(n.path,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(q)});return a.then(v(t),v(t)),a}function bt(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=C(arguments),e=Object.assign({},n.data),r=G(e),t=new Date,a=Promise.all(r).then(function(){return D(n.path,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(q)});return a.then(v(t),v(t)),a}function Et(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=C(arguments),e=new Date,r=D(n.path,{method:"DELETE"}).then(q);return r.then(v(e),v(e)),r}function wt(){this.id="",this.src="",this.name="",this.width=0,this.height=0}var tt=0,I=0,J=[],w={Image:wt,GET:Z,POST:nt,PUT:bt,DELETE:Et,GET_QUEUE:function(){var n=tt;tt++;function e(r){return function(t){if(n===I){if(J.forEach(function(a,i){I=i+1,a(a.res)}),J=[],I=Math.max(I,n+1),r==="resolve")return t;throw t}else return new Promise(function(a,i){var m=r==="resolve"?a:i;m.res=t,J[n]=m})}}return Z.apply(this,arguments).then(e("resolve"),e("reject"))}};const et=(n,e)=>{var r={};return Object.assign(r,{init:function(t,a){return r.url=t,r.params=a,r},fetch:function(){return w.GET(r.url,r.params).then(function(t){r.rows=t})},create:function(t){return w.POST(r.url,t)},save:function(t){return t.id?w.PUT(r.url,t.id,t):r.create(t)},remove:function(t){return typeof t=="object"&&(t=t.id),w.DELETE(r.url,t)},put:function(){var t=Array.from(arguments);return t=[r.url].concat(t),w.PUT.apply(w,t)}}),r.init(n,e)};var xt=A("<h1>Videos</h1>"),Pt=A('<h2 class="menu-title-sub">정보</h2> <!> <!> <space size="32"></space> <div class="hbox gap(10)"><!> <!></div> <div flex=""></div> <ui-search></ui-search>',3),Ot=A('<ul><li menu-1=""> <span> </span></li></ul>'),At=A('<ul><li menu-1=""> <span> </span></li></ul>'),Dt=A('<h1>상태</h1> <!> <space size="32"></space> <h1>카테고리</h1> <!>',1);function Mt(n,e){lt(e,!1);const r=["main","works","directors","plan v"];let t=F(null),a=F({category:[],tags:[],search:"",page:0,limit:25}),i={},m=Promise.resolve([]);const M=et("/admin/api/items",s(a));et("/admin/api/items/count",{});const x=()=>{B(t,null),M.fetch()},rt=o=>(V(a,s(a).status=s(a).status===o?null:o),x()),at=o=>(V(a,s(a).category=s(a).category===o?null:o),x()),ot=o=>{o=structuredClone(o),o.tags=o.tags||[],o.tag_categories=o.tag_categories||[],o.created_at2=Date.format("yyyy-mm-dd hh:ii:ss",o.created_at)},W=(o,h)=>(o.status=h,it(o)),st=o=>{if(confirm("정말 삭제하시겠습니까?"))return M.remove(o).then(function(){return B(t,null),x()})},it=o=>{console.log("@@@",o),store,o.status=o.status||"비공개";try{o.created_at=new Date(o.created_at2).toISOString()}catch(h){console.log(h)}return M.save(o).then(function(){return ct(),x()})},ct=()=>{B(t,null)};ut(()=>{m=w.GET("/admin/api/configs/tags"),m.then(o=>{o=Object.entries(o).reduce((h,[p,g])=>(h[p]=g.trim().split(/\n+/),h),{})}),x()}),ft(),dt(n,{$$slots:{titlebar:(o,h)=>{var p=xt();d(o,p)},toolbar:(o,h)=>{var p=Pt(),g=f(Q(p),2);S(g,{type:"simple",icon:"add",$$events:{click:()=>ot({})},children:(y,N)=>{U();var T=j("ADD");d(y,T)},$$slots:{default:!0}});var L=f(g,2);const O=z(()=>s(t)==null);S(L,{type:"simple",icon:"remove",get disabled(){return s(O)},$$events:{click:()=>st(s(t))},children:(y,N)=>{U();var T=j("DELETE");d(y,T)},$$slots:{default:!0}});var c=f(L,4),l=b(c);const u=z(()=>s(t)==null);S(l,{type:"simple",get disabled(){return s(u)},$$events:{click:()=>W(s(t),"공개")},children:(y,N)=>{U();var T=j("공개");d(y,T)},$$slots:{default:!0}});var _=f(l,2);const $=z(()=>s(t)==null);S(_,{type:"simple",get disabled(){return s($)},$$events:{click:()=>W(s(t),"비공개")},children:(y,N)=>{U();var T=j("비공개");d(y,T)},$$slots:{default:!0}}),E(c);var P=f(c,4);R(()=>pt(P,"value",s(a).search)),H("submit",P,x),d(o,p)},sidebar:(o,h)=>{var p=Dt(),g=f(Q(p),2);Y(g,0,()=>["공개","비공개"],K,(O,c)=>{var l=Ot(),u=b(l),_=b(u),$=f(_),P=b($);E($),E(u),E(l),R(()=>{X(u,s(a).status===c),k(_,`${c??""} `),k(P,`(${i[c]||"0"})`)}),H("click",u,()=>rt(c)),d(O,l)});var L=f(g,6);Y(L,1,()=>r,K,(O,c)=>{var l=At(),u=b(l),_=b(u),$=f(_),P=b($);E($),E(u),E(l),R(()=>{X(u,s(a).category===s(c)),k(_,`${s(c)??""} `),k(P,`(${i[s(c)]||"0"})`)}),H("click",u,()=>at(s(c))),d(O,l)}),d(o,p)}}}),ht()}export{Mt as component};
