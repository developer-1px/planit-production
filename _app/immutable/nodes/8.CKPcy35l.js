import"../chunks/NZTpNUN0.js";import"../chunks/69_IOA4Y.js";import{o as ut}from"../chunks/erN7JwqA.js";import{X as lt,g as s,C as F,Z as ht,f as A,a0 as f,a2 as Q,a as d,a3 as U,a4 as k,k as z,_ as b,$ as E,a1 as R,s as B,Y as V}from"../chunks/DhavXi9s.js";import{e as H,s as S}from"../chunks/DDewMqrm.js";import{e as X,i as Y,s as pt,a as Z}from"../chunks/DMofKf_K.js";import{i as ft}from"../chunks/CruA9uEo.js";import{A as dt,U as j}from"../chunks/qW8ISQDX.js";const vt=(n,e)=>new Promise(function(r){setTimeout(function(){r(n())},e)});var gt=150;function D(n,e){var r="",t="same-origin",a="same-origin";return n=r+n,e.mode=t,e.credentials=a,fetch(n,e)}function mt(n){console.log("fileUpload",n);var e=n.src;return Promise.resolve(_t(e)).then(function(r){return r.type.indexOf("image")===-1?r:new Promise(function(t,a){var i=document.createElement("img");i.onload=function(){r.width=i.naturalWidth||i.width,r.height=i.naturalHeight||i.height,t(r)},i.onerror=function(){a()},i.src=e})}).then(function(r){return nt("/api/files/upload-url").then(function(t){return t.upload_url}).then(function(t){var a=new FormData;return a.append("file",r),a.append("name",n.name),a.append("type",r.type),a.append("size",r.size),a.append("width",r.width),a.append("height",r.height),D(t,{method:"POST",body:a})}).then(function(t){return t.json()})})}function _t(n){var e;n.split(",")[0].indexOf("base64")>=0?e=atob(n.split(",")[1]):e=unescape(n.split(",")[1]);for(var r=n.split(",")[0].split(":")[1].split(";")[0],t=new Uint8Array(e.length),a=0;a<e.length;a++)t[a]=e.charCodeAt(a);return new Blob([t],{type:r})}function $t(n){return n?n.slice(0,5)==="data:":!1}function yt(n){return console.log(n),Object(n)===n&&$t(n.src)}function G(n){for(var e=[],r={},t=0,a=n.length;t<a;t++){var i=n[t],g=typeof i;switch(g){case"number":case"string":e.push(i);break;case"object":r=i;break}}return{path:e.join("/"),data:r}}function Tt(n){return n.json().then(function(e){if(n.ok)return e;throw e&&e.reason&&console.error(e.reason),e})}function q(n){return n.json().then(function(e){if(n.ok)return e;throw e&&e.reason&&(console.error(e.reason),alert(e.reason)),e})}function v(n){return function(e){return n=Math.max(0,gt-(new Date-n)),vt(function(){return typeof globalThis.hideLoading=="function"&&globalThis.hideLoading(),e},n)}}function C(n,e){return e=e||[],foreach(n,function(r,t){if(Array.isArray(r)){C(r,e);return}if(yt(r)){delete n[t],e.push(mt(r).then(function(a){n[t]=a}));return}if(Object(r)===r){C(r,e);return}}),e}function K(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=G(arguments),e=Object.assign({},n.data);e=JSON.stringify(e),e!=="{}"&&(n.path+="?json="+encodeURIComponent(e));var r=new Date,t=D(n.path,{method:"GET"}).then(Tt);return t.then(v(r),v(r)),t}function nt(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=G(arguments),e=Object.assign({},n.data),r=C(e),t=new Date,a=Promise.all(r).then(function(){return D(n.path,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(q)});return a.then(v(t),v(t)),a}function bt(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=G(arguments),e=Object.assign({},n.data),r=C(e),t=new Date,a=Promise.all(r).then(function(){return D(n.path,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(q)});return a.then(v(t),v(t)),a}function Et(){typeof globalThis.showLoading=="function"&&globalThis.showLoading();var n=G(arguments),e=new Date,r=D(n.path,{method:"DELETE"}).then(q);return r.then(v(e),v(e)),r}function wt(){this.id="",this.src="",this.name="",this.width=0,this.height=0}var tt=0,I=0,J=[],w={Image:wt,GET:K,POST:nt,PUT:bt,DELETE:Et,GET_QUEUE:function(){var n=tt;tt++;function e(r){return function(t){if(n===I){if(J.forEach(function(a,i){I=i+1,a(a.res)}),J=[],I=Math.max(I,n+1),r==="resolve")return t;throw t}else return new Promise(function(a,i){var g=r==="resolve"?a:i;g.res=t,J[n]=g})}}return K.apply(this,arguments).then(e("resolve"),e("reject"))}};const et=(n,e)=>{var r={};return Object.assign(r,{init:function(t,a){return r.url=t,r.params=a,r},fetch:function(){return w.GET(r.url,r.params).then(function(t){r.rows=t})},create:function(t){return w.POST(r.url,t)},save:function(t){return t.id?w.PUT(r.url,t.id,t):r.create(t)},remove:function(t){return typeof t=="object"&&(t=t.id),w.DELETE(r.url,t)},put:function(){var t=Array.from(arguments);return t=[r.url].concat(t),w.PUT.apply(w,t)}}),r.init(n,e)};var xt=A("<h1>Videos</h1>"),Pt=A('<h2 class="menu-title-sub">정보</h2> <!> <!> <space size="32"></space> <div class="hbox gap(10)"><!> <!></div> <div flex=""></div> <ui-search></ui-search>',3),Ot=A('<ul><li menu-1=""> <span> </span></li></ul>'),At=A('<ul><li menu-1=""> <span> </span></li></ul>'),Dt=A('<h1>상태</h1> <!> <space size="32"></space> <h1>카테고리</h1> <!>',1);function Mt(n,e){lt(e,!1);const r=["main","works","directors","plan v"];let t=F(null),a=F({category:[],tags:[],search:"",page:0,limit:25}),i={},g=Promise.resolve([]);const M=et("/admin/api/items",s(a));et("/admin/api/items/count",{});const x=()=>{B(t,null),M.fetch()},rt=o=>(V(a,s(a).status=s(a).status===o?null:o),x()),at=o=>(V(a,s(a).category=s(a).category===o?null:o),x()),ot=o=>{o=structuredClone(o),o.tags=o.tags||[],o.tag_categories=o.tag_categories||[],o.created_at2=Date.format("yyyy-mm-dd hh:ii:ss",o.created_at)},W=(o,h)=>(o.status=h,it(o)),st=o=>{if(confirm("정말 삭제하시겠습니까?"))return M.remove(o).then(function(){return B(t,null),x()})},it=o=>{console.log("@@@",o),store,o.status=o.status||"비공개";try{o.created_at=new Date(o.created_at2).toISOString()}catch(h){console.log(h)}return M.save(o).then(function(){return ct(),x()})},ct=()=>{B(t,null)};ut(()=>{g=w.GET("/admin/api/configs/tags"),g.then(o=>{o=Object.entries(o).reduce((h,[p,m])=>(h[p]=m.trim().split(/\n+/),h),{})}),x()}),ft(),dt(n,{$$slots:{titlebar:(o,h)=>{var p=xt();d(o,p)},toolbar:(o,h)=>{var p=Pt(),m=f(Q(p),2);j(m,{type:"simple",icon:"add",$$events:{click:()=>ot({})},children:(y,N)=>{U();var T=k("ADD");d(y,T)},$$slots:{default:!0}});var L=f(m,2);const O=z(()=>s(t)==null);j(L,{type:"simple",icon:"remove",get disabled(){return s(O)},$$events:{click:()=>st(s(t))},children:(y,N)=>{U();var T=k("DELETE");d(y,T)},$$slots:{default:!0}});var c=f(L,4),l=b(c);const u=z(()=>s(t)==null);j(l,{type:"simple",get disabled(){return s(u)},$$events:{click:()=>W(s(t),"공개")},children:(y,N)=>{U();var T=k("공개");d(y,T)},$$slots:{default:!0}});var _=f(l,2);const $=z(()=>s(t)==null);j(_,{type:"simple",get disabled(){return s($)},$$events:{click:()=>W(s(t),"비공개")},children:(y,N)=>{U();var T=k("비공개");d(y,T)},$$slots:{default:!0}}),E(c);var P=f(c,4);R(()=>pt(P,"value",s(a).search)),H("submit",P,x),d(o,p)},sidebar:(o,h)=>{var p=Dt(),m=f(Q(p),2);X(m,0,()=>["공개","비공개"],Y,(O,c)=>{var l=Ot(),u=b(l),_=b(u),$=f(_),P=b($);E($),E(u),E(l),R(()=>{Z(u,s(a).status===c),S(_,`${c??""} `),S(P,`(${i[c]||"0"})`)}),H("click",u,()=>rt(c)),d(O,l)});var L=f(m,6);X(L,1,()=>r,Y,(O,c)=>{var l=At(),u=b(l),_=b(u),$=f(_),P=b($);E($),E(u),E(l),R(()=>{Z(u,s(a).category===s(c)),S(_,`${s(c)??""} `),S(P,`(${i[s(c)]||"0"})`)}),H("click",u,()=>at(s(c))),d(O,l)}),d(o,p)}}}),ht()}export{Mt as component};
